cat <<EOF > /tmp/lxd-profile-default.yaml
config:
  user.user-data: |
    #cloud-config
    package_upgrade: true
    packages:
      - jq
      - vim
      - lnav
      - snapd
      - squashfuse
    ssh_import_id:
      - ${ccio_SSH_SERVICE}:${ccio_SSH_UNAME}
    users:
      - name: ${ccio_SSH_UNAME}
        sudo: ['ALL=(ALL) NOPASSWD:ALL']
        shell: /bin/bash
        groups: [adm,dialout,cdrom,floppy,sudo,audio,dip,video,plugdev,lxd,netdev]
        ssh_import_id:
          - ${ccio_SSH_SERVICE}:${ccio_SSH_UNAME}
    write_files:
      - encoding: b64
        content: |
          XhEb0xteUM3YUI1bzRRTmEyYUMKem5KK1hWRkM5ZkNbGxqb0NOZ21ReTZzbXFsbVNmSF
        owner: ${ccio_SSH_UNAME}:${ccio_SSH_UNAME}
        path: /home/${ccio_SSH_UNAME}/.ssh/id_rsa.pub
      - encoding: b64
        content: |
          XhEb0xteUM3YUI1bzRRTmEyYUMKem5KK1hWRkM5ZkNbGxqb0NOZ21ReTZzbXFsbVNmSF
        owner: ${ccio_SSH_UNAME}:${ccio_SSH_UNAME}
        path: /home/${ccio_SSH_UNAME}/.ssh/id_rsa
    runcmd:
      - [apt-get, autoremove, "-y"]
      - [cp, "-f", "/etc/skel/.bashrc", "/root/.bashrc"]
      - [cp, "-f", "/etc/skel/.bashrc", "/home/${ccio_SSH_UNAME}/.bashrc"]
      - [su, -l, ${ccio_SSH_UNAME}, /bin/bash, -c, "ssh-import-id", "${ccio_SSH_SERVICE}:${ccio_SSH_UNAME}"]
description: Default LXD Profile
devices:
  eth0:
    name: eth0
    nictype: macvlan
    parent: wan
    type: nic
  root:
    path: /
    pool: default
    type: disk
name: default
EOF
